<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>배경화면 설정하기</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
<h2>배경화면으로 지정하고 싶은 파일을 선택해주세요!</h2>
<form action="/BgImgMenu/inputBgImg" method="post" enctype="multipart/form-data">
    <div class="inputImg">
        <input type="file" name="Fileinput" id="Fileinput" accept="image/*">
        <button type="button" onclick="uploadFile()"> file Upload </button>
    </div>
</form>


<div class="grid_imgs">
    <p>현재 당신의 배경화면 목록</p>
    <div class="imageContainer"></div>
</div>

<div id="gallary">
</div>

</body>
</html>

<script>
    function uploadFile(){
        var fileInput = $('#Fileinput')[0];
        var file = fileInput.files[0];

        if (file) {
        var formData = new FormData();
        formData.append('Fileinput', file);

        $.ajax({
            type: 'POST',
            url: '/BgImgMenu/inputBgImg',
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                // 처리 완료 후의 동작을 여기에 추가할 수 있습니다.
                console.log(response);
                for (var i = 0; i < response.length; i++) {
                    var imageUrl = response[i].replace(/\\/g, "/");
                    console.error('이미지 url : ' + imageUrl)
                    // 이미지가 존재하는지 확인
                    $.get(imageUrl)
                        .done(function() {
                            //기존 데이터 지우고
                            $(".grid").empty();
                            //새로 로드
                            $(".imageContainer").append('<img src="' + imageUrl + '" alt="Image" width=300 height=300>')
                        })
                        .fail(function() {
                            // 이미지가 존재하지 않으면 오류 메시지 출력
                            console.error('Image not found: ' + imageUrl);
                        });
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    } else {
        alert('파일을 선택하세요.');
    }

    }



</script>